# Ахтунг.

**Важно:** Проект создавался для презентации своих навыков и включал в себя только разработку API. Со временем проект был заброшен, и сейчас до него дошли руки, чтобы доделать до логического завершения.
_Возможно, буду писать обновление. Смотреть ветку dev._


### TODO: Вещи, которые стоит сделать, чтобы проект смотрелся завершенным.

1. Сделать refactoring code, поработать над названиями переменных и классов.
2. Переделать авторизацию, сделать вход по Cookie.
3. Прикрутить работу с barcode и qrcode, сотрудникам и магазинам выдать barcode, товарам сделать qrcode.
4. Добавить визуальную часть для сотрудников, также заложить на буду заказ самими пользователями.
5. Покрыть всю серверную часть тестами.
6. Добавить отправку кода на почту для регистрации.


# Запускаем проект в демонстрационном режиме.

### Настраиваем переменные окружения.

1. Проект написан на Python 3.11.7

2. Переходим в папку /backend.
> cd ./backend

3. Ставим все зависимости.
> pip install -r ./requirements.txt

4. Создаём файл .env и заполняем данные.
```
DEBUG=""  # Режим отладки [True|False]
POSTGRESQL_USER=""  # Имя пользователя postgresql
POSTGRESQL_PASSWORD=""  # Пароль пользователя postgresql
POSTGRESQL_HOST=""  # Хост, на котором крутится база данных
POSTGRESQL_PORT=""  # Порт, на котором крутится база данных
POSTGRESQL_DATABASE=""  # Имя базы данных
```


### Создание ключей для JWT.

1. Переходим в директорию jwt.
> cd ./auth/jwt

2. Создаем приватный ключ.
> openssl genrsa -out private.pem 2048

3. Создаем публичный ключ из приватного.
> openssl rsa -in private.pem -outform PEM -pubout -out public.pem


### Создания владельца магазина.

1. Возвращаемся в папку /backend.
> cd ./../..

2. Применяем изменения базы данных.
> alembic upgrade head

3. Вставьте эту команду и свой введите пароль 2 раза. Если вы ввели его 2 раза и он совпал, тогда вам выдастся захешированный пароль, иначе вы увидите сообщение the password does not match.
```
python -c "
from getpass import getpass
from security.users import hash_password
passwd = getpass('enter password: ')
repeat_password = getpass('repeat password: ')
print(
hash_password(passwd)
if passwd == repeat_password
else 'the password does not match'
)
"
```

4. Подставьте в SQL-запрос свои данные и выполните его. Вместо owner@example.com свою почту и password поменять на значение с прошлого этапа.
> insert into users (email, password, status) values ('owner@example.com', 'password', 'owner');


### Запускаем проект.

1. Запускаем uvicorn.
> uvicorn main:app

2 . Переходим по ссылке и можем потыкать функционал.
[Docs](http://127.0.0.1:8000/docs).


# Аутентификация

**Важно:** В документации FastAPI (по адресу `/docs`) параметр для входа называется `username`, но на самом деле это поле ожидает ваш `email`. Пожалуйста, используйте его при выполнении запроса.


### TODO: Подумать над аутентификацией с использованием JWT access и refresh токенов.

1. При входе пользователя на `/login` выдавать два токена: access и refresh
2. Хранить refresh токен в cookies для обеспечения длительной аутентификации
3. Для работы с функционалом приложения использовать access токен, который имеет короткий срок действия для повышения безопасности
4. Добавить endpoint `/shops/access/refresh`, где клиент сможет запросить новый access токен, используя refresh токен из cookies, и получать доступ без повторного входа
5. Дополнительно хранить shop_id в access токене
